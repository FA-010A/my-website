<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°è¾æ›¸</title>

    <!-- å¤–éƒ¨CSSã‚¹ã‚¿ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã¿ -->
    <link rel="stylesheet" href="style.css" type="text/css" />

    <!-- PWAå¯¾å¿œã®ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆ -->
    <link rel="manifest" href="manifest.json" />
  </head>

  <body>
    <h1>ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°è¾æ›¸</h1>
    <h2>éšæ™‚æ›´æ–°ä¸­</h2>

    <!-- memo.txtãƒ•ã‚¡ã‚¤ãƒ«ã®ä¸­èº«ã‚’è¡¨ç¤º -->
    <object
      class="box8"
      data="memo.txt"
      type="text/plain"
      width="100%"
      height="100%"
    ></object>

    <!-- æ³¨æ„äº‹é …ã®ãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«è¡¨ç¤º -->
    <h2>æ³¨æ„äº‹é …</h2>
    <object
      class="box8"
      data="æ³¨æ„äº‹é ….txt"
      type="text/plain"
      width="100%"
      height="100%"
    ></object>

    <!-- ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒ¡ãƒ‹ãƒ¥ãƒ¼ -->
    <div id="nav">
      <h2>ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒ¡ãƒ‹ãƒ¥ãƒ¼</h2>
      <ul>
        <li><a href="html.html">HTML</a></li>
        <li><a href="css.html">CSS</a></li>
        <li><a href="JavaScript.html">JavaScript</a></li>
        <li><a href="Java.html">Java</a></li>
        <li><a href="Python.html">Python</a></li>
      </ul>
    </div>

    <!-- Firebaseã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‹ã‚‰ã®ãƒ•ã‚¡ã‚¤ãƒ«è¡¨ç¤ºã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
    <h1>Firebase Storage è¡¨ç¤º</h1>
    <h2>é¸æŠã—ãŸãƒ†ã‚­ã‚¹ãƒˆå†…å®¹</h2>

    <!-- ãƒ•ã‚¡ã‚¤ãƒ«ã®ä¸­èº«ã‚’è¡¨ç¤ºã™ã‚‹é ˜åŸŸ -->
    <div class="box8">
      <pre
        id="file-content"
        style="font-size: 18px;"
      >é¸æŠã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã®å†…å®¹ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚</pre>
    </div>

    <!-- å„è¨€èªãƒ•ã‚©ãƒ«ãƒ€ã”ã¨ã®ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§ -->
    <h2>ãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§</h2>

    <div class="box8">
      <h3>HTML</h3>
      <ul id="fileList-html"></ul>
    </div>

    <div class="box8">
      <h3>CSS</h3>
      <ul id="fileList-css"></ul>
    </div>

    <div class="box8">
      <h3>JavaScript</h3>
      <ul id="fileList-js"></ul>
    </div>

    <div class="box8">
      <h3>Java</h3>
      <ul id="fileList-java"></ul>
    </div>

    <div class="box8">
      <h3>Python</h3>
      <ul id="fileList-python"></ul>
    </div>

    <!-- Firebase JavaScript SDK ã‚’ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å½¢å¼ã§èª­ã¿è¾¼ã¿ -->
    <script type="module">
      // Firebase SDKï¼ˆã‚¢ãƒ—ãƒªã€ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ï¼‰ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
      import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
      import {
        getStorage,
        ref,
        listAll,
        getDownloadURL,
        getBlob,
      } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-storage.js";

      // Firebaseãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®è¨­å®šï¼ˆã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ«ãƒ¼ãƒ«ã«æ³¨æ„ï¼‰
      const firebaseConfig = {
        apiKey: "AIzaSyB-Wck9-5KQJLVfWWhE8yBdaW5Jl_3XWis",
        authDomain: "my-website-2b713.firebaseapp.com",
        projectId: "my-website-2b713",
        storageBucket: "my-website-2b713.firebasestorage.app", // ä¿®æ­£ï¼šæ­£ã—ãã¯ .appspot.com
        messagingSenderId: "474696820051",
        appId: "1:474696820051:web:7cba8563bb4b025af7eda6",
        measurementId: "G-52N4LS8E57",
      };

      // Firebase ã‚¢ãƒ—ãƒªã¨ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚’åˆæœŸåŒ–
      const app = initializeApp(firebaseConfig);
      const storage = getStorage(app);

      // å„è¨€èªã”ã¨ã®ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ãƒ‘ã‚¹ã¨HTMLè¦ç´ ã®å¯¾å¿œè¡¨
      const langs = [
        { id: "fileList-html", folder: "uploads/HTML" },
        { id: "fileList-css", folder: "uploads/CSS" },
        { id: "fileList-js", folder: "uploads/JavaScript" },
        { id: "fileList-java", folder: "uploads/Java" },
        { id: "fileList-python", folder: "uploads/Python" },
      ];

      const fileContentElem = document.getElementById("file-content");

      // å„ãƒ•ã‚©ãƒ«ãƒ€ã”ã¨ã«å‡¦ç†ï¼ˆãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§ã®å–å¾—ã¨è¡¨ç¤ºï¼‰
      langs.forEach(({ id, folder }) => {
        const listElement = document.getElementById(id);
        listElement.textContent = "";

        const listRef = ref(storage, folder); // ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸å‚ç…§ã‚’ä½œæˆ

        // ãƒ•ã‚©ãƒ«ãƒ€å†…ã®å…¨ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å–å¾—
        listAll(listRef)
          .then((res) => {
            if (res.items.length === 0) {
              listElement.textContent = "ãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“";
              return;
            }

            // å„ãƒ•ã‚¡ã‚¤ãƒ«ã«å¯¾ã—ã¦ãƒªãƒ³ã‚¯ä½œæˆã¨ã‚­ãƒ£ãƒƒã‚·ãƒ¥
            res.items.forEach(async (itemRef) => {
              await cacheFileContent(itemRef); // ä¸­èº«ã‚’äº‹å‰å–å¾—ã—ã¦ã‚­ãƒ£ãƒƒã‚·ãƒ¥
              displayFileList(itemRef, listElement); // ãƒªã‚¹ãƒˆã«ã‚¯ãƒªãƒƒã‚¯å¯èƒ½ãƒªãƒ³ã‚¯è¿½åŠ 
            });
          })
          .catch((error) => {
            listElement.textContent = "ã‚¨ãƒ©ãƒ¼: " + error.message;
            console.error(error);
          });
      });

      // ğŸ”» åˆ¥ãƒ•ã‚¡ã‚¤ãƒ« app.js ã«å®šç¾©ã•ã‚Œã¦ã„ã‚‹é–¢æ•°ãŒå¿…è¦ï¼š
      // - cacheFileContent(itemRef)
      // - displayFileList(itemRef, listElement)
    </script>

    <!-- å¤–éƒ¨ã®ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆé–¢æ•°å®šç¾©ãªã©ï¼‰ã‚’ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¨ã—ã¦èª­ã¿è¾¼ã¿ -->
    <script type="module" src="app.js"></script>
  </body>
</html>