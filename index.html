<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>プログラミング辞書</title>

    <!-- 外部CSSスタイルを読み込み -->
    <link rel="stylesheet" href="style.css" type="text/css" />

    <!-- PWA対応のマニフェスト -->
    <link rel="manifest" href="manifest.json" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  </head>
<body>
  <h1>プログラミング辞書</h1>
    <!-- memo.txtファイルの中身を表示 -->
    <object
      class="box8"
      data="memo.txt"
      type="text/plain"
      width="100%"
      height="100%"
    ></object>

    <!-- 注意事項のテキストファイル表示 -->
    <h2>注意事項</h2>
    <object
      class="box8"
      data="注意事項.txt"
      type="text/plain"
      width="100%"
      height="100%"
    ></object>

    <!-- ナビゲーションメニュー -->
    <div id="nav">
      <h2>ナビゲーションメニュー</h2>
      <ul>
        <li><a href="html.html">HTML</a></li>
        <li><a href="css.html">CSS</a></li>
        <li><a href="JavaScript.html">JavaScript</a></li>
        <li><a href="Java.html">Java</a></li>
        <li><a href="Python.html">Python</a></li>
      </ul>
    </div>

    <!-- Firebaseストレージからのファイル表示セクション -->
    <h1>Firebase Storage 表示</h1>
    <h2>選択したテキスト内容</h2>

    <!-- ファイルの中身を表示する領域 -->
    <div class="box8">
      <pre
        id="file-content"
        style="font-size: 18px;"
      >選択したファイルの内容が表示されます。</pre>
    </div>

    <!-- 各言語フォルダごとのファイル一覧 -->
    <h2>テキストファイル一覧</h2>

    <div class="box8">
      <h3>HTML</h3>
      <ul id="fileList-html"></ul>
    </div>

    <div class="box8">
      <h3>CSS</h3>
      <ul id="fileList-css"></ul>
    </div>

    <div class="box8">
      <h3>JavaScript</h3>
      <ul id="fileList-js"></ul>
    </div>

    <div class="box8">
      <h3>Java</h3>
      <ul id="fileList-java"></ul>
    </div>

    <div class="box8">
      <h3>Python</h3>
      <ul id="fileList-python"></ul>
    </div>

    <!-- Firebase JavaScript SDK をモジュール形式で読み込み -->
    <script type="module">
      // Firebase SDK（アプリ、ストレージ）をインポート
      import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
      import {
        getStorage,
        ref,
        listAll,
        getDownloadURL,
        getBlob,
      } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-storage.js";

      // Firebaseプロジェクトの設定（セキュリティルールに注意）
      const firebaseConfig = {
        apiKey: "AIzaSyB-Wck9-5KQJLVfWWhE8yBdaW5Jl_3XWis",
        authDomain: "my-website-2b713.firebaseapp.com",
        projectId: "my-website-2b713",
        storageBucket: "my-website-2b713.firebasestorage.app", // 修正：正しくは .appspot.com
        messagingSenderId: "474696820051",
        appId: "1:474696820051:web:7cba8563bb4b025af7eda6",
        measurementId: "G-52N4LS8E57",
      };

      // Firebase アプリとストレージを初期化
      const app = initializeApp(firebaseConfig);
      const storage = getStorage(app);

      // 各言語ごとのストレージパスとHTML要素の対応表
      const langs = [
        { id: "fileList-html", folder: "uploads/HTML" },
        { id: "fileList-css", folder: "uploads/CSS" },
        { id: "fileList-js", folder: "uploads/JavaScript" },
        { id: "fileList-java", folder: "uploads/Java" },
        { id: "fileList-python", folder: "uploads/Python" },
      ];

      // 各フォルダごとに処理（ファイル一覧の取得と表示）
      langs.forEach(({ id, folder }) => {
        const listElement = document.getElementById(id);
        listElement.textContent = "";

        const listRef = ref(storage, folder); // ストレージ参照を作成

        // フォルダ内の全ファイルを取得
        listAll(listRef)
          .then((res) => {
            if (res.items.length === 0) {
              listElement.textContent = "ファイルが見つかりません";
              return;
            }

            // 各ファイルに対してリンク作成とキャッシュ
            res.items.forEach(async (itemRef) => {
              await cacheFileContent(itemRef); // 中身を事前取得してキャッシュ
              displayFileList(itemRef, listElement); // リストにクリック可能リンク追加
            });
          })
          .catch((error) => {
            listElement.textContent = "エラー: " + error.message;
            console.error(error);
          });
        });
  </script>

  <footer>
    <a href="#" class="btn-real-dent" id="scroll-top">
      <i class="fa fa-home"></i>
    </a>
  </footer>
  <script>
    document.getElementById("scroll-top").addEventListener("click", function (e) {
      e.preventDefault();
      window.scrollTo({
        top: 0,
        behavior: "smooth"
      });
    });
  </script>

    <!-- 外部のロジック（関数定義など）をモジュールとして読み込み -->
    <script type="module" src="app.js"></script>
  </body>
</html>